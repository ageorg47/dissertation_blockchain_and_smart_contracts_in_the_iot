<!DOCTYPE html>
<html>
  <head>
    <title>Blockchain-based IoT Network</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Latest compiled and minified CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-
1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />

    <!-- Latest compiled and minified javascript library -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"
    ></script>
    <!-- Popper JS -->
    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"
      integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB"
      crossorigin="anonymous"
    ></script>
    <!-- Latest compiled JavaScript -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"
      integrity="sha384-
QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13"
      crossorigin="anonymous"
    ></script>

    <style>
      body {
        background-color: black;
        background-attachment: fixed;
        background-size: cover;
        background-position: center;
      }
    </style>
  </head>
  <body>
    <h2
      style="
        text-align: center;
        color: white;
        text-shadow: 2px 2px 4px #ffffff;
        margin-top: 40px;
        margin-bottom: 10px;
      "
    >
      Blockchain-based IoT Network <br />
      Manager Interface
    </h2>
    <div class="rounded bg-light bg-opacity-50 p-4 mx-3 border border-dark">
      <!--Requesting (Current) Manager Form-->
      <h3>Requesting (Current) Manager
        <span class="required" style="color:red;">*</span>
      </h3>
      <form id="requesting-manager-form">
        <label for="manager-address-input">Manager Address:</label>
        <input
          type="text"
          id="current-manager-address-input"
          name="manager-address"
          required
        />
      </form>
    </div>
    <div class="rounded bg-light bg-opacity-50 p-4 mx-3 border border-dark">
      <!--Check whether a device is registered Form-->
      <h3>Check whether a device is registered</h3>
      <form id="check-device-form">
        <label for="device-address-input">Device Address:</label>
        <input
          type="text"
          id="device-address-input"
          name="device-address"
          required
        />
        <button class="btn btn-dark btn-sm" type="submit">Check</button>
      </form>
      <div id="check-device-response"></div>
    </div>
    <div class="rounded bg-light bg-opacity-50 p-4 mx-3 border border-dark">
      <!-- Manager Registration Form -->
      <h3>Register Manager</h3>
      <form id="manager-registration-form">
        <label for="manager-address-input">Manager Address:</label>
        <input
          type="text"
          id="manager-address-input"
          name="manager-address"
          required
        />
        <label for="manager-name-input">Manager Name:</label>
        <input
          type="text"
          id="manager-name-input"
          name="manager-name"
          required
        />
        <button class="btn btn-dark btn-sm" type="submit">Register</button>
      </form>
      <div id="manager-registration-response"></div>
    </div>
    <div class="rounded bg-light bg-opacity-50 p-4 mx-3 border border-dark">
      <!-- Device Registration Form -->
      <h3>Register Device</h3>
      <form id="device-registration-form">
        <label for="device-name-input">Device Name:</label>
        <input type="text" id="device-name-input" name="device-name" required />
        <label for="device-id-input">Device ID:</label>
        <input type="number" id="device-id-input" name="device-id" required />
        <label for="device-address-input">Device Address:</label>
        <input
          type="text"
          id="device-address-input-2"
          name="device-address"
          required
        />
        <button class="btn btn-dark btn-sm" type="submit">Register</button>
      </form>
      <div id="device-registration-response"></div>
    </div>
    <div class="rounded bg-light bg-opacity-50 p-4 mx-3 border border-dark">
      <!-- Add Manager to Device Form -->
      <h3>Add Manager to Device</h3>
      <form id="add-manager-form">
        <label for="device-id-input">Device ID:</label>
        <input type="number" id="device-id-input-2" name="device-id" required />
        <label for="manager-address-input">Manager Address:</label>
        <input
          type="text"
          id="manager-address-input-2"
          name="manager-address"
          required
        />
        <button class="btn btn-dark btn-sm" type="submit">Add Manager</button>
      </form>
      <div id="add-manager-response"></div>
    </div>
    <div class="rounded bg-light bg-opacity-50 p-4 mx-3 border border-dark">
      <!-- Remove Manager from Device Form -->
      <h3>Remove Manager from Device</h3>
      <form id="remove-manager-form">
        <label for="device-id-input">Device ID:</label>
        <input type="number" id="device-id-input-3" name="device-id" required />
        <label for="manager-address-input">Manager Address:</label>
        <input
          type="text"
          id="manager-address-input-3"
          name="manager-address"
          required
        />
        <button class="btn btn-dark btn-sm" type="submit">
          Remove Manager
        </button>
      </form>
      <div id="remove-manager-response"></div>
    </div>
    <div class="rounded bg-light bg-opacity-50 p-4 mx-3 border border-dark">
      <!-- Add Rule Form -->
      <h3>Add Rule</h3>
      <form id="add-rule-form">
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="manager-address-input">Manager Address:</label>
            <input
              type="text"
              id="manager-address-input-4"
              name="manager-address"
              required
            />
          </div>
          <div class="col-md-6 mb-3">
            <label for="constrained-device-address-input"
              >Constrained Device Address:</label
            >
            <input
              type="text"
              id="constrained-device-address-input"
              name="constrained-device-address"
              required
            />
          </div>
        </div>
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="new-device-address-input">New Device Address:</label>
            <input
              type="text"
              id="new-device-address-input"
              name="new-device-address"
              required
            />
          </div>
          <div class="col-md-6 mb-3">
            <label for="resource-input">Resource:</label>
            <input type="number" id="resource-input" name="resource" required />
          </div>
        </div>
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="access-rights-input">Access Rights:</label>
            <input
              type="text"
              id="access-rights-input"
              name="access-rights"
              required
            />
          </div>
          <div class="col-md-6 mb-3">
            <label for="expiration-blocks-input">Expiration Block:</label>
            <input
              type="number"
              id="expiration-blocks-input"
              name="expiration-blocks"
              required
            />
          </div>
        </div>
        <button class="btn btn-dark btn-sm" type="submit">Add Rule</button>
      </form>
      <div id="add-rule-response"></div>
    </div>
    <div class="rounded bg-light bg-opacity-50 p-4 mx-3 border border-dark">
      <!-- Manager De-Registration Form -->
      <h3>De-Register Manager</h3>
      <form id="manager-de-registration-form">
        <label for="manager-address-input">Manager Address:</label>
        <input
          type="text"
          id="manager-address-input-5"
          name="manager-address"
          required
        />
        <button class="btn btn-dark btn-sm" type="submit">De-Register</button>
      </form>
      <div id="manager-de-registration-response"></div>
    </div>
    <div class="rounded bg-light bg-opacity-50 p-4 mx-3 border border-dark">
      <!-- Device De-Registration Form -->
      <h3>De-Register Device</h3>
      <form id="device-de-registration-form">
        <label for="device-id-input">Device ID:</label>
        <input type="text" id="device-id-input-4" name="device-id" required />
        <button class="btn btn-dark btn-sm" type="submit">De-Register</button>
      </form>
      <div id="device-de-registration-response"></div>
    </div>
    <div class="rounded bg-light bg-opacity-50 p-4 mx-3 border border-dark">
      <!-- Revoke Permission Form-->
      <h3>Revoke Permission</h3>
      <form id="revoke-permission-form">
        <label for="manager-address-input">Manager Address:</label>
        <input
          type="text"
          id="manager-address-input-6"
          name="manager-address"
          required
        />
        <label for="constrained-device-address-input"
          >Constrained Device Address:</label
        >
        <input
          type="text"
          id="constrained-device-address-input-2"
          name="constrained-device-address"
          required
        />
        <label for="new-device-address-input">New Device Address:</label>
        <input
          type="text"
          id="new-device-address-input-2"
          name="new-device-address"
          required
        />
        <button class="btn btn-dark btn-sm" type="submit">
          Revoke Permission
        </button>
      </form>
      <div id="revoke-permission-response"></div>
    </div>
    <div class="rounded bg-light bg-opacity-50 p-4 mx-3 border border-dark">
      <!-- Get Manager Form -->
      <h3>Get Manager</h3>
      <form id="get-manager-form">
        <label for="manager-address-input">Manager Address:</label>
        <input
          type="text"
          id="manager-address-input-7"
          name="manager-address"
          required
        />
        <button class="btn btn-dark btn-sm" type="submit">Get Manager</button>
      </form>
      <div id="get-manager-response"></div>
    </div>
    <div class="rounded bg-light bg-opacity-50 p-4 mx-3 border border-dark">
      <!-- Query Permission Form -->
      <h3>Query Permission</h3>
      <form id="query-permission-form">
        <label for="constrained-device-address-input"
          >Constrained Device Address:</label
        >
        <input
          type="text"
          id="constrained-device-address-input-3"
          name="constrained-device-address"
          required
        />
        <label for="new-device-address-input">New Device Adress:</label>
        <input
          type="text"
          id="new-device-address-input-3"
          name="resource"
          required
        />
        <button class="btn btn-dark btn-sm" type="submit">
          Query Permission
        </button>
      </form>
      <div id="query-permission-response"></div>
    </div>
    <script src="api_calls.js"></script>
    <!-- Script to make the API calls using listeners on the buttons using the functions in the file api_calls.js-->
    <script>
      // Register Manager
      document
        .getElementById("manager-registration-form")
        .addEventListener("submit", function (event) {
          event.preventDefault();
          var managerAddress = document.getElementById(
            "manager-address-input"
          ).value;
          var managerName = document.getElementById("manager-name-input").value;
          var currentManagerAddress = document.getElementById(
            "current-manager-address-input"
          ).value;
          var managerRegistrationResponse = document.getElementById(
            "manager-registration-response"
          );
          //Show response by calling the function
          managerRegistrationResponse.innerHTML = registerManager(
            managerAddress,
            managerName,
            currentManagerAddress
          );
        });

      // Register Device
      document
        .getElementById("device-registration-form")
        .addEventListener("submit", function (event) {
          event.preventDefault();
          var deviceAddress = document.getElementById(
            "device-address-input-2"
          ).value;
          var deviceName = document.getElementById("device-name-input").value;
          var deviceId = document.getElementById("device-id-input").value;
          var currentManagerAddress = document.getElementById(
            "current-manager-address-input"
          ).value;
          var deviceRegistrationResponse = document.getElementById(
            "device-registration-response"
          );
          //Show response by calling the function
          deviceRegistrationResponse.innerHTML = registerDevice(
            deviceAddress,
            deviceName,
            deviceId,
            currentManagerAddress
          );
        });

      // Add Manager to Device
      document
        .getElementById("add-manager-form")
        .addEventListener("submit", function (event) {
          event.preventDefault();
          var deviceId = document.getElementById("device-id-input-2").value;
          var managerAddress = document.getElementById(
            "manager-address-input-2"
          ).value;
          var currentManagerAddress = document.getElementById(
            "current-manager-address-input"
          ).value;
          var addManagerResponse = document.getElementById(
            "add-manager-response"
          );
          //Show response by calling the function
          addManagerResponse.innerHTML = addManager(
            deviceId,
            managerAddress,
            currentManagerAddress
          );
        });

      // Remove Manager from Device
      document
        .getElementById("remove-manager-form")
        .addEventListener("submit", function (event) {
          event.preventDefault();
          var deviceId = document.getElementById("device-id-input-3").value;
          var managerAddress = document.getElementById(
            "manager-address-input-3"
          ).value;
          var currentManagerAddress = document.getElementById(
            "current-manager-address-input"
          ).value;
          var removeManagerResponse = document.getElementById(
            "remove-manager-response"
          );
          //Show response by calling the function
          removeManagerResponse.innerHTML = removeManager(
            deviceId,
            managerAddress,
            currentManagerAddress
          );
        });

      // Add Rule
      document
        .getElementById("add-rule-form")
        .addEventListener("submit", function (event) {
          event.preventDefault();
          var managerAddress = document.getElementById(
            "manager-address-input-4"
          ).value;
          var constrainedDeviceAddress = document.getElementById(
            "constrained-device-address-input"
          ).value;
          var newDeviceAddress = document.getElementById(
            "new-device-address-input"
          ).value;
          var resource = document.getElementById("resource-input").value;
          var accessRights = document.getElementById(
            "access-rights-input"
          ).value;
          var expirationBlocks = document.getElementById(
            "expiration-blocks-input"
          ).value;
          var currentManagerAddress = document.getElementById(
            "current-manager-address-input"
          ).value;
          var addRuleResponse = document.getElementById("add-rule-response");
          //Show response by calling the function
          addRuleResponse.innerHTML = addRule(
            managerAddress,
            constrainedDeviceAddress,
            newDeviceAddress,
            resource,
            accessRights,
            expirationBlocks,
            currentManagerAddress
          );
        });

      // De-Register Manager
      document
        .getElementById("manager-de-registration-form")
        .addEventListener("submit", function (event) {
          event.preventDefault();
          var managerAddress = document.getElementById(
            "manager-address-input-5"
          ).value;
          var currentManagerAddress = document.getElementById(
            "current-manager-address-input"
          ).value;
          var managerDeRegistrationResponse = document.getElementById(
            "manager-de-registration-response"
          );
          //Show response by calling the function
          managerDeRegistrationResponse.innerHTML = deregisterManager(
            managerAddress,
            currentManagerAddress
          );
        });

      // De-Register Device
      document
        .getElementById("device-de-registration-form")
        .addEventListener("submit", function (event) {
          event.preventDefault();
          var deviceId = document.getElementById("device-id-input-4").value;
          var currentManagerAddress = document.getElementById(
            "current-manager-address-input"
          ).value;
          var deviceDeRegistrationResponse = document.getElementById(
            "device-de-registration-response"
          );
          //Show response by calling the function
          deviceDeRegistrationResponse.innerHTML = deregisterDevice(
            deviceId,
            currentManagerAddress
          );
        });

      // Revoke a permission
      document
        .getElementById("revoke-permission-form")
        .addEventListener("submit", function (event) {
          event.preventDefault();
          var managerAddress = document.getElementById(
            "manager-address-input-6"
          ).value;
          var constrainedDeviceAddress = document.getElementById(
            "constrained-device-address-input-2"
          ).value;
          var newDeviceAddress = document.getElementById(
            "new-device-address-input-2"
          ).value;
          var revokePermissionResponse = document.getElementById(
            "revoke-permission-response"
          );
          var currentManagerAddress = document.getElementById(
            "manager-address-input"
          ).value;
          //Show response by calling the function
          revokePermissionResponse.innerHTML = revokePermission(
            managerAddress,
            constrainedDeviceAddress,
            newDeviceAddress,
            currentManagerAddress
          );
        });

      // Get Manager
      document
        .getElementById("get-manager-form")
        .addEventListener("submit", function (event) {
          event.preventDefault();
          var managerAddress = document.getElementById(
            "manager-address-input-7"
          ).value;
          var getManagerResponse = document.getElementById(
            "get-manager-response"
          );
          //Show response by calling the function
          getManagerResponse.innerHTML = getManager(managerAddress);
        });

      // Get Device
      document
        .getElementById("check-device-form")
        .addEventListener("submit", function (event) {
          event.preventDefault();
          var deviceAddress = document.getElementById(
            "device-address-input"
          ).value;
          var getDeviceResponse = document.getElementById(
            "check-device-response"
          );
          //Show response by calling the function
          getDeviceResponse.innerHTML = checkDevice(deviceAddress);
        });

      // Query Permission
      document
        .getElementById("query-permission-form")
        .addEventListener("submit", function (event) {
          event.preventDefault();
          var constrainedDeviceAddress = document.getElementById(
            "constrained-device-address-input-3"
          ).value;
          var newDeviceAddress = document.getElementById(
            "new-device-address-input-3"
          ).value;
          var queryPermissionResponse = document.getElementById(
            "query-permission-response"
          );
          //Show response by calling the function
          queryPermissionResponse.innerHTML = queryPermission(
            constrainedDeviceAddress,
            newDeviceAddress
          );
        });
    </script>
  </body>
</html>
